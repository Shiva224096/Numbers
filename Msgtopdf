Sub ConvertMsgToPdfAndSaveAttachments()
    Dim objOL As Object
    Dim Msg As Object
    Dim InPath As String
    Dim ThisFile As String
    Dim NewFileName As String
    Dim MHT_File As String
    Dim PDF_FILE As String
    Dim AttachmentsFolder As String
    
    ' Set the folder where the MSG files are located
    InPath = "C:\Temp\msg_to_pdf" ' Change this path to your specific folder
    
    ' Set the folder where attachments will be saved
    AttachmentsFolder = "C:\Temp\attachments" ' Change this path to your desired folder
    
    ' Create an Outlook object
    Set objOL = CreateObject("Outlook.Application")
    
    ' Loop through all MSG files in the folder
    ThisFile = Dir(InPath & "\*.msg")
    Do While ThisFile <> ""
        ' Sort out file name plus the new extensions
        NewFileName = Left(ThisFile, Len(ThisFile) - 4) ' Remove ".msg" extension
        MHT_File = NewFileName & ".mht"
        PDF_FILE = NewFileName & ".pdf"
        
        ' Open the MSG file
        Set Msg = objOL.Session.OpenSharedItem(InPath & "\" & ThisFile)
        
        ' Save the MSG file as MHT format
        Msg.SaveAs InPath & "\" & MHT_File, olMHTML
        
        ' Export the MHT file as PDF
        Msg.ExportAsFixedFormat olFormatPDF, InPath & "\" & PDF_FILE
        
        ' Save attachments to the specified folder
        For Each att In Msg.Attachments
            att.SaveAsFile AttachmentsFolder & "\" & att.FileName
        Next att
        
        ' Close the MSG file
        Msg.Close olDiscard
        
        ' Get the next MSG file
        ThisFile = Dir
    Loop
    
    ' Clean up
    Set Msg = Nothing
    Set objOL = Nothing
End Sub
